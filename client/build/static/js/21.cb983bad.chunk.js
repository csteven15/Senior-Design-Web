(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{6385:function(e,t,a){"use strict";a.r(t);var n=a(72),r=a(73),o=a(75),i=a(74),s=a(76),l=a(277),u=a(0),c=a.n(u),d=a(6200),p=a(65),h=a.n(p),m=a(59),g=a(144),f=a(66),b=a(19),y=a(202),D="permit-violations",v=function(e){function t(e){var a;Object(n.a)(this,t),(a=Object(o.a)(this,Object(i.a)(t).call(this,e))).handleStartDateChange=function(e){a.setState({startDate:e.getTime()},function(){return a.updateMap()})},a.handleEndDateChange=function(e){e.setHours(23,59,59,999),a.setState({endDate:e.getTime()},function(){return a.updateMap()})},a.makeFeatureCollection=function(e){return{type:"FeatureCollection",features:e}},a.makeHeatMapLayer=function(e,t){return{id:e,source:t,maxzoom:24,type:"heatmap",paint:{"heatmap-weight":["interpolate",["linear"],["get","mag"],0,0,1,1],"heatmap-intensity":["interpolate",["linear"],["zoom"],0,1,24,3],"heatmap-color":["interpolate",["linear"],["heatmap-density"],0,"rgba(33,102,172,0)",.2,"rgb(103,169,207)",.4,"rgb(209,229,240)",.6,"rgb(253,219,199)",.8,"rgb(239,138,98)",1,"rgb(178,24,43)"],"heatmap-radius":["interpolate",["linear"],["zoom"],0,2,24,20],"heatmap-opacity":["interpolate",["linear"],["zoom"],7,1,50,0]}}},a.onViewportChange=function(e){return a.setState({viewport:e})},a.getMap=function(){return a._mapRef.current?a._mapRef.current.getMap():null},a.setMapData=function(e){var t=a._getMap();t&&t.getSource(D).setData(a._mkFeatureCollection(e))},a.updateMap=function(){var e=a.getMap(),t={startDate:new Date(a.state.startDate).setHours(0,0,0,0),endDate:new Date(a.state.endDate).setHours(23,59,59,999)};a.props.fetchHelp().then(function(n){h.a.get("/api/violations/fetchViolations?".concat(new URLSearchParams(t).toString()),{headers:n.headers}).then(function(t){if(400!==t.status){var n={type:"FeatureCollection",features:[]};t.data.results.map(function(e){var t={geometry:{coordinates:[e.location.longitude,e.location.latitude,e.location.altitude],type:"Point"},properties:{date:e.data,issuer:e.issuer,licensePlate:e.licensePlate},type:"Feature"};return n.features.push(t),0}),a.setState({violations:n},function(){e.getSource(D).setData(a.makeFeatureCollection(n.features))})}else a.props.dispatch(Object(f.a)({message:"Failed to fetch data.",options:{variant:"warning"}}))})})};var r=new Date;return a.state={viewport:{latitude:28.6024274,longitude:-81.2022486,zoom:15,bearing:0,pitch:0},startDate:new Date(r.getTime()-864e5).getTime(),endDate:(new Date).getTime(),violations:null},a._mapRef=c.a.createRef(),a.handleStartDateChange=a.handleStartDateChange.bind(Object(l.a)(Object(l.a)(a))),a.handleEndDateChange=a.handleEndDateChange.bind(Object(l.a)(Object(l.a)(a))),a}return Object(s.a)(t,e),Object(r.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.getMap(),a={startDate:this.state.startDate,endDate:this.state.endDate};this.props.fetchHelp().then(function(n){h.a.get("/api/violations/fetchViolations?".concat(new URLSearchParams(a).toString()),{headers:n.headers}).then(function(a){if(400!==a.status){var n={type:"FeatureCollection",features:[]};a.data.results.map(function(e){var t={geometry:{coordinates:[e.location.longitude,e.location.latitude,e.location.altitude],type:"Point"},properties:{date:e.data,issuer:e.issuer,licensePlate:e.licensePlate},type:"Feature"};return n.features.push(t),0}),e.setState({violations:n},function(){t.on("load",function(){t.addSource(D,{type:"geojson",data:n}),t.addLayer(e.makeHeatMapLayer("heatmap-layer",D))})})}else e.props.dispatch(Object(f.a)({message:"Failed to fetch data.",options:{variant:"warning"}}))})})}},{key:"render",value:function(){var e=this.state,t=e.viewport,a=e.startDate,n=e.endDate;return c.a.createElement("div",{style:{height:"100%"}},c.a.createElement(d.a,Object.assign({ref:this._mapRef},t,{width:"100%",height:"95%",mapStyle:"mapbox://styles/mapbox/dark-v9",onViewportChange:this.onViewportChange,mapboxApiAccessToken:"pk.eyJ1Ijoic2VhbmF0aGFubWxlZSIsImEiOiJjanJyMWtzdG8xdW10NDlwOXc4bDNtejA3In0.jfEEyI0M1BWfsoEOVe84sA"})),c.a.createElement(b.G,{style:{width:"250px",position:"absolute",right:"30px",top:"100px",padding:"20px"}},c.a.createElement(b.V,{variant:"body1",gutterBottom:!0},"Showing Heat Map from:"),c.a.createElement(b.V,{variant:"body1",gutterBottom:!0},"Start Date"),c.a.createElement(y.a,{keyboard:!1,clearable:!0,disableOpenOnEnter:!0,value:a,onChange:this.handleStartDateChange,maxdate:new Date,disableFuture:!0,format:"MM/dd/yyyy",mask:function(e){return e?[/\d/,/\d/,"/",/\d/,/\d/,"/",/\d/,/\d/,/\d/,/\d/]:[]}}),c.a.createElement("br",null),c.a.createElement("br",null),c.a.createElement(b.V,{variant:"body1",gutterBottom:!0},"End Date"),c.a.createElement(y.a,{keyboard:!1,clearable:!0,disableOpenOnEnter:!0,value:n,onChange:this.handleEndDateChange,minDate:a,maxdate:new Date,format:"MM/dd/yyyy",disableFuture:!0,mask:function(e){return e?[/\d/,/\d/,"/",/\d/,/\d/,"/",/\d/,/\d/,/\d/,/\d/]:[]}})))}}]),t}(c.a.Component);t.default=Object(m.b)(null,function(e){return{fetchHelp:function(t,a,n,r){return e(Object(g.a)(t,a,n,r))}}})(v)}}]);
//# sourceMappingURL=21.cb983bad.chunk.js.map